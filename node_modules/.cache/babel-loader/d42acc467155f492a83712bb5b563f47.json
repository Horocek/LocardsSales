{"ast":null,"code":"import _regeneratorRuntime from\"/Users/maximpodorogin/Desktop/Sales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/maximpodorogin/Desktop/Sales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(login,pass,card){var autorized,crmToken,cardInfo,sales;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return loginUser(login,pass);case 2:autorized=_context.sent;if(autorized){_context.next=5;break;}return _context.abrupt(\"return\",[false,\"НЕ ВЕРНЫЙ ЛОГИН/ПАРОЛЬ\"]);case 5:_context.next=7;return getCrmToken(autorized);case 7:crmToken=_context.sent;_context.next=10;return getCard(crmToken,card);case 10:cardInfo=_context.sent;if(cardInfo){_context.next=13;break;}return _context.abrupt(\"return\",[false,\"КАРТА НЕ НАЙДЕНА\"]);case 13:_context.next=15;return getSales(cardInfo.id,autorized);case 15:sales=_context.sent;if(sales){_context.next=18;break;}return _context.abrupt(\"return\",[false,\"НЕТ ПРОДАЖ\"]);case 18:return _context.abrupt(\"return\",[cardInfo,sales]);case 19:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(_x,_x2,_x3){return _ref.apply(this,arguments);};}();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(login,pass){var user,response,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:user={email:login,password:pass};_context2.next=3;return fetch('https://api.lo.cards/v1/user/login',{method:'POST',headers:{'Content-Type':'application/json;charset=utf-8'},body:JSON.stringify(user)});case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:result=_context2.sent;return _context2.abrupt(\"return\",!result.success?result.success:result.data);case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function loginUser(_x4,_x5){return _ref2.apply(this,arguments);};}();var getCrmToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(JWT){var response,result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch('https://api.lo.cards/v1/integration',{method:'GET',headers:{'Authorization':\"Bearer \".concat(JWT),'Content-Type':'application/json;charset=utf-8'}});case 2:response=_context3.sent;_context3.next=5;return response.json();case 5:result=_context3.sent;return _context3.abrupt(\"return\",result.data[0].token);case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function getCrmToken(_x6){return _ref3.apply(this,arguments);};}();var getCard=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(CRM,card){var response,result;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return fetch(\"https://api.lo.cards/v1/crm/card/\".concat(card),{method:'GET',headers:{'Authorization':\"Bearer \".concat(CRM),'Content-Type':'application/json;charset=utf-8'}});case 2:response=_context4.sent;_context4.next=5;return response.json();case 5:result=_context4.sent;return _context4.abrupt(\"return\",!result.success?result.success:result.data);case 7:case\"end\":return _context4.stop();}}},_callee4);}));return function getCard(_x7,_x8){return _ref4.apply(this,arguments);};}();var getSales=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(cardId,JWT){var response,result;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return fetch(\"https://api.lo.cards/v1/analytics/sale-for-card/\".concat(cardId),{method:'GET',headers:{'Authorization':\"Bearer \".concat(JWT),'Content-Type':'application/json;charset=utf-8'}});case 2:response=_context5.sent;_context5.next=5;return response.json();case 5:result=_context5.sent;return _context5.abrupt(\"return\",result.data.length===0?false:result.data);case 7:case\"end\":return _context5.stop();}}},_callee5);}));return function getSales(_x9,_x10){return _ref5.apply(this,arguments);};}();export{fetchData};","map":{"version":3,"sources":["/Users/maximpodorogin/Desktop/Sales/src/utils/Api.js"],"names":["fetchData","login","pass","card","loginUser","autorized","getCrmToken","crmToken","getCard","cardInfo","getSales","id","sales","user","email","password","fetch","method","headers","body","JSON","stringify","response","json","result","success","data","JWT","token","CRM","cardId","length"],"mappings":"iTAAA,GAAMA,CAAAA,SAAS,0FAAG,iBAAOC,KAAP,CAAcC,IAAd,CAAoBC,IAApB,8KACWC,CAAAA,SAAS,CAACH,KAAD,CAAQC,IAAR,CADpB,QACRG,SADQ,kBAETA,SAFS,yDAES,CAAC,KAAD,CAAQ,wBAAR,CAFT,+BAGSC,CAAAA,WAAW,CAACD,SAAD,CAHpB,QAGRE,QAHQ,sCAISC,CAAAA,OAAO,CAACD,QAAD,CAAWJ,IAAX,CAJhB,SAIRM,QAJQ,kBAKTA,QALS,0DAKQ,CAAC,KAAD,CAAQ,kBAAR,CALR,iCAMMC,CAAAA,QAAQ,CAACD,QAAQ,CAACE,EAAV,CAAcN,SAAd,CANd,SAMRO,KANQ,kBAQTA,KARS,0DAQK,CAAC,KAAD,CAAO,YAAP,CARL,0CASP,CAACH,QAAD,CAAWG,KAAX,CATO,yDAAH,kBAATZ,CAAAA,SAAS,oDAAf,CAYA,GAAMI,CAAAA,SAAS,2FAAG,kBAAOH,KAAP,CAAcC,IAAd,+IACRW,IADQ,CACD,CACTC,KAAK,CAAEb,KADE,CAETc,QAAQ,CAAEb,IAFD,CADC,wBAKSc,CAAAA,KAAK,CAAC,oCAAD,CAAuC,CAC/DC,MAAM,CAAE,MADuD,CAE/DC,OAAO,CAAE,CACL,eAAgB,gCADX,CAFsD,CAK/DC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAeR,IAAf,CALyD,CAAvC,CALd,QAKRS,QALQ,uCAYUA,CAAAA,QAAQ,CAACC,IAAT,EAZV,QAYNC,MAZM,iDAaL,CAACA,MAAM,CAACC,OAAR,CAAkBD,MAAM,CAACC,OAAzB,CAAmCD,MAAM,CAACE,IAbrC,0DAAH,kBAATtB,CAAAA,SAAS,kDAAf,CAiBA,GAAME,CAAAA,WAAW,2FAAG,kBAAOqB,GAAP,iKAEOX,CAAAA,KAAK,CAAC,qCAAD,CAAwC,CAChEC,MAAM,CAAE,KADwD,CAEhEC,OAAO,CAAE,CACL,iCAA2BS,GAA3B,CADK,CAEL,eAAgB,gCAFX,CAFuD,CAAxC,CAFZ,QAEVL,QAFU,uCASQA,CAAAA,QAAQ,CAACC,IAAT,EATR,QASRC,MATQ,iDAUPA,MAAM,CAACE,IAAP,CAAY,CAAZ,EAAeE,KAVR,0DAAH,kBAAXtB,CAAAA,WAAW,8CAAjB,CAaA,GAAME,CAAAA,OAAO,2FAAG,kBAAOqB,GAAP,CAAY1B,IAAZ,iKAEWa,CAAAA,KAAK,4CAAqCb,IAArC,EAA6C,CACrEc,MAAM,CAAE,KAD6D,CAErEC,OAAO,CAAE,CACL,iCAA2BW,GAA3B,CADK,CAEL,eAAgB,gCAFX,CAF4D,CAA7C,CAFhB,QAENP,QAFM,uCASYA,CAAAA,QAAQ,CAACC,IAAT,EATZ,QASJC,MATI,iDAUH,CAACA,MAAM,CAACC,OAAR,CAAkBD,MAAM,CAACC,OAAzB,CAAmCD,MAAM,CAACE,IAVvC,0DAAH,kBAAPlB,CAAAA,OAAO,kDAAb,CAaA,GAAME,CAAAA,QAAQ,2FAAG,kBAAOoB,MAAP,CAAeH,GAAf,iKAEUX,CAAAA,KAAK,2DAAoDc,MAApD,EAA8D,CACtFb,MAAM,CAAE,KAD8E,CAEtFC,OAAO,CAAE,CACL,iCAA2BS,GAA3B,CADK,CAEL,eAAgB,gCAFX,CAF6E,CAA9D,CAFf,QAEPL,QAFO,uCASWA,CAAAA,QAAQ,CAACC,IAAT,EATX,QASLC,MATK,iDAUJA,MAAM,CAACE,IAAP,CAAYK,MAAZ,GAAuB,CAAvB,CAA2B,KAA3B,CAAmCP,MAAM,CAACE,IAVtC,0DAAH,kBAARhB,CAAAA,QAAQ,mDAAd,CAYA,OACIV,SADJ","sourcesContent":["const fetchData = async (login, pass, card) => {\n    const autorized =  await loginUser(login, pass);\n    if (!autorized) return [false, \"НЕ ВЕРНЫЙ ЛОГИН/ПАРОЛЬ\"];\n    const crmToken = await getCrmToken(autorized)\n    const cardInfo = await getCard(crmToken, card)\n    if (!cardInfo) return [false, \"КАРТА НЕ НАЙДЕНА\"];\n    const sales = await getSales(cardInfo.id, autorized);\n    //if (!sales && cardInfo) return [true, cardInfo];\n    if (!sales) return [false,\"НЕТ ПРОДАЖ\"];\n    return [cardInfo, sales];\n};\n\nconst loginUser = async (login, pass) => {\n    const user = {\n        email: login,\n        password: pass\n    };\n    const response = await fetch('https://api.lo.cards/v1/user/login', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json;charset=utf-8'\n        },\n        body: JSON.stringify(user)\n      });\n      const result =  await response.json();\n      return !result.success ? result.success : result.data;\n}\n\n\nconst getCrmToken = async (JWT) => {\n\n    const response = await fetch('https://api.lo.cards/v1/integration', {\n        method: 'GET',\n        headers: {\n            'Authorization': `Bearer ${JWT}`,\n            'Content-Type': 'application/json;charset=utf-8'\n        }\n      });\n      const result =  await response.json();\n      return result.data[0].token;\n}\n\nconst getCard = async (CRM, card) => {\n\n    const response = await fetch(`https://api.lo.cards/v1/crm/card/${card}`, {\n        method: 'GET',\n        headers: {\n            'Authorization': `Bearer ${CRM}`,\n            'Content-Type': 'application/json;charset=utf-8'\n        }\n      });\n      const result =  await response.json();\n      return !result.success ? result.success : result.data;\n}\n\nconst getSales = async (cardId, JWT) => {\n\n    const response = await fetch(`https://api.lo.cards/v1/analytics/sale-for-card/${cardId}`, {\n        method: 'GET',\n        headers: {\n            'Authorization': `Bearer ${JWT}`,\n            'Content-Type': 'application/json;charset=utf-8'\n        }\n      });\n      const result =  await response.json();\n      return result.data.length === 0 ? false : result.data;\n}\nexport {\n    fetchData\n};"]},"metadata":{},"sourceType":"module"}